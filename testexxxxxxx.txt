Teste 1: Autentica√ß√£o e Autoriza√ß√£o (O "Porteiro")
Nosso objetivo aqui √© garantir que o login funciona e que os diferentes "cargos" (Gerente vs. Vendedor) t√™m os acessos corretos.

1.1 Login do Administrador
Requisi√ß√£o: POST http://localhost:9090/api/auth/login

Body (JSON):

JSON

{
    "login": "admin",
    "senha": "123456"
}
Resultado Esperado: 200 OK e um JSON com o token.

A√ß√£o: Copie o token. Vamos cham√°-lo de [TOKEN_ADMIN].

1.2 Teste de Permiss√£o de Gerente (Deve Funcionar)
Requisi√ß√£o: GET http://localhost:9090/api/funcionarios

Authorization: Bearer Token (cole o [TOKEN_ADMIN])

Resultado Esperado: 200 OK e uma lista contendo o usu√°rio "Administrador". (Isso testa o hasRole('GERENTE')).

1.3 Criar um Vendedor (Teste de Gerente)
Requisi√ß√£o: POST http://localhost:9090/api/funcionarios

Authorization: Bearer Token ([TOKEN_ADMIN])

Body (JSON):

JSON

{
    "nome": "Vendedor Teste",
    "cpf": "111.222.333-44",
    "cargo": "VENDEDOR",
    "login": "vendedor",
    "senha": "123"
}
Resultado Esperado: 201 Created.

1.4 Login do Vendedor
Requisi√ß√£o: POST http://localhost:9090/api/auth/login

Body (JSON):

JSON

{
    "login": "vendedor",
    "senha": "123"
}
Resultado Esperado: 200 OK e um novo token.

A√ß√£o: Copie este novo token. Vamos cham√°-lo de [TOKEN_VENDEDOR].

1.5 Teste de Permiss√£o de Vendedor (Deve Falhar)
Requisi√ß√£o: GET http://localhost:9090/api/funcionarios

Authorization: Bearer Token (use o [TOKEN_VENDEDOR])

Resultado Esperado: 403 Forbidden. Isso prova que o "Vendedor" n√£o pode acessar endpoints de "Gerente".

1.6 Teste de Permiss√£o Mista (Deve Funcionar)
Requisi√ß√£o: GET http://localhost:9090/api/clientes

Authorization: Bearer Token ([TOKEN_VENDEDOR])

Resultado Esperado: 200 OK. (Isso testa o hasAnyRole('GERENTE', 'VENDEDOR')).

üì¶ Teste 2: CRUD e L√≥gica de Neg√≥cio (Prepara√ß√£o)
Agora, vamos usar o [TOKEN_ADMIN] para cadastrar os itens que precisamos para o teste de venda.

2.1 Criar Categoria
Requisi√ß√£o: POST http://localhost:9090/api/categorias

Authorization: Bearer Token ([TOKEN_ADMIN])

Body (JSON): {"nome": "Cal√ßas"}

Resultado Esperado: 201 Created. Anote o id (provavelmente 1).

2.2 Criar Produto (com Estoque)
Requisi√ß√£o: POST http://localhost:9090/api/produtos

Authorization: Bearer Token ([TOKEN_ADMIN])

Body (JSON): (Assumindo que o id da categoria "Cal√ßas" √© 1)

JSON

{
    "nome": "Cal√ßa Jeans Slim",
    "precoVarejo": 150.00,
    "precoAtacado": 90.00,
    "quantidadeEstoque": 10,
    "categoria": {
        "id": 1
    }
}
Resultado Esperado: 201 Created. Anote o id (provavelmente 1).

2.3 Criar Cliente
Requisi√ß√£o: POST http://localhost:9090/api/clientes

Authorization: Bearer Token ([TOKEN_VENDEDOR] ou [TOKEN_ADMIN])

Body (JSON): {"nome": "Cliente de Teste", "cpfCnpj": "12345678900"}

Resultado Esperado: 201 Created. Anote o id (provavelmente 1).

üí∏ Teste 3: L√≥gica de Venda (O Teste Final)
Este √© o teste mais importante. Vamos usar o [TOKEN_VENDEDOR].

3.1 Venda com Estoque (Caminho Feliz)
Requisi√ß√£o: POST http://localhost:9090/api/vendas

Authorization: Bearer Token ([TOKEN_VENDEDOR])

Body (JSON): (Usando os IDs que anotamos)

JSON

{
    "clienteId": 1,
    "tipoVenda": "VAREJO",
    "formaPagamento": "PIX",
    "itens": [
        {
            "produtoId": 1,
            "quantidade": 2
        }
    ]
}
Resultado Esperado: 201 Created. A resposta deve mostrar a venda completa, com o valorTotal calculado (ex: 150.00 * 2 = 300.00).

3.2 Verifica√ß√£o de Estoque (P√≥s-Venda)
Requisi√ß√£o: GET http://localhost:9090/api/produtos/1 (ou o ID do produto que voc√™ criou)

Authorization: Bearer Token ([TOKEN_ADMIN])

Resultado Esperado: 200 OK. O JSON do produto deve agora mostrar "quantidadeEstoque": 8 (pois come√ßou com 10 e vendemos 2).

3.3 Venda Sem Estoque (Caminho de Erro)
Requisi√ß√£o: POST http://localhost:9090/api/vendas

Authorization: Bearer Token ([TOKEN_VENDEDOR])

Body (JSON): (O estoque agora √© 8. Vamos tentar comprar 9)

JSON

{
    "clienteId": 1,
    "tipoVenda": "VAREJO",
    "formaPagamento": "Dinheiro",
    "itens": [
        {
            "produtoId": 1,
            "quantidade": 9
        }
    ]
}
Resultado Esperado: 400 Bad Request. O corpo da resposta deve conter a mensagem de erro que programamos, algo como: "Estoque insuficiente para o produto: Cal√ßa Jeans Slim".